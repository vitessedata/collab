;; Q1 - Pricing Summary Report Query
;; select
;;   l_returnflag,
;;   l_linestatus,
;;   sum(l_quantity) as sum_qty,
;;   sum(l_extendedprice) as sum_base_price,
;;   sum(l_extendedprice * (1 - l_discount)) as sum_disc_price,
;;   sum(l_extendedprice * (1 - l_discount) * (1 + l_tax)) as sum_charge,
;;   avg(l_quantity) as avg_qty,
;;   avg(l_extendedprice) as avg_price,
;;   avg(l_discount) as avg_disc,
;;   count(*) as count_order
;; from
;;   lineitem
;; where
;;   l_shipdate <= '1998-09-02'
;; group by
;;   l_returnflag,
;;   l_linestatus
(plan
 (groupby (bucket (var l_returnflag)
		  (var l_linestatus))
	  (function (sum (var l_quantity))
		    (sum (var l_extendedprice))
		    (sum (* (var l_extendedprice) (- (real 1) (var l_discount))))
		    (sum (* (* (var l_extendedprice) (- (real 1) (var l_discount))) (+ (real 1) (var l_tax))))
		    (sum (var l_quantity))
		    (count (var l_quantity))
		    (sum (var l_extendedprice))
		    (count (var l_extendedprice))
		    (sum (var l_discount))
		    (count (var l_discount))
		    (count (int 1)))
	  (scan (symtab (l_orderkey i64v) 
			(l_partkey i64v) 
			(l_suppkey i64v) 
			(l_linenumber i64v) 
			(l_quantity fp64v) 
			(l_extendedprice fp64v) 
			(l_discount fp64v) 
			(l_tax fp64v) 
			(l_returnflag strv) 
			(l_linestatus strv) 
			(l_shipdate datev) 
			(l_commitdate datev) 
			(l_receiptdate datev) 
			(l_shipinstruct strv) 
			(l_shipmode strv) 
			(l_comment strv))
		(symbol l_returnflag
			l_linestatus
			l_quantity
			l_extendedprice
			l_discount
			l_tax)
		(path lineitem.xrg))
	  ))
